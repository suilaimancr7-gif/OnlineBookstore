@page "/orders"
@using OnlineBookstore.Domain.Entities
@using OnlineBookstore.Infrastructure.Contracts
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@rendermode InteractiveServer
@inject IGenericRepository<Order> OrderRepo
@inject NavigationManager NavigationManager

<PageTitle>Orders</PageTitle>

<h1>Orders</h1>

<table class="table table-hover align-middle shadow-sm rounded">
    <thead class="table-dark">
        <tr>
            <th>Order ID</th>
            <th>Customer ID</th> @* User ID requirement *@
            <th>Order Date</th>
            <th>Total Price</th>
            <th class="text-center">Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var order in orders)
        {
            <tr>
                <td>@order.Id</td>
                <td>@order.CustomerId</td>
                <td>@order.OrderDate.ToShortDateString()</td>
                <td>@order.TotalPrice.ToString("C")</td>
                <td class="text-center">
                    <div class="btn-group">
                        <a href="@($"orders/details?id={order.Id}")" class="btn btn-outline-info btn-sm">Details</a>

                        <AuthorizeView Roles="Administrator">
                            <Authorized>
                                @* Admin can Edit and Delete orders *@
                                <a href="@($"orders/edit?id={order.Id}")" class="btn btn-outline-warning btn-sm mx-1">Edit</a>
                                <button class="btn btn-outline-danger btn-sm" @onclick="() => DeleteOrder(order.Id)">Delete</button>
                            </Authorized>
                        </AuthorizeView>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>

@code {
    private List<Order> orders = new();

    protected override async Task OnInitializedAsync()
    {
        var data = await OrderRepo.GetAll();
        orders = data.ToList();
    }

    private async Task DeleteOrder(int id)
    {
        await OrderRepo.Delete(id); // Admin Delete functionality
        orders = (await OrderRepo.GetAll()).ToList();
    }
}
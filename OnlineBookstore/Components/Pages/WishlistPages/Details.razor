@page "/wishlist/details"
@using OnlineBookstore.Domain.Entities
@using OnlineBookstore.Infrastructure.Contracts
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@inject IGenericRepository<Wishlist> WishlistRepo

<div class="container mt-4">
    <div class="card shadow p-4 rounded bg-white">
        <h3>Wishlist Item Details</h3>
        <hr />

        @if (item == null)
        {
            <div class="text-center p-5">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2">Loading details...</p>
            </div>
        }
        else
        {
            <dl class="row">
                <dt class="col-sm-3">Book Title</dt>
                <dd class="col-sm-9 fw-bold text-primary">@item.Book?.Title</dd>

                <dt class="col-sm-3">Description</dt>
                <dd class="col-sm-9 text-muted">@item.Book?.Description</dd>

                <dt class="col-sm-3">Price (Physical)</dt>
                <dd class="col-sm-9">@item.Book?.PricePhysical.ToString("C")</dd>

                <dt class="col-sm-3">Added On</dt>
                <dd class="col-sm-9">@item.DateAdded.ToString("f")</dd>
            </dl>

            <div class="mt-4">
                <a href="/wishlist" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Back to List
                </a>
                <a href="@($"/books/details?id={item.BookId}")" class="btn btn-primary ms-2">
                    View Book Page
                </a>
            </div>
        }
    </div>
</div>

@code {
    [SupplyParameterFromQuery] public int Id { get; set; }
    private Wishlist? item;

    protected override async Task OnInitializedAsync()
    {
        // Use the includes parameter to ensure the Book title is loaded
        item = await WishlistRepo.Get(
            expression: q => q.Id == Id,
            includes: q => q.Include(w => w.Book)
        );
    }
}